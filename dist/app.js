"use strict";var PORT=process.env.PORT||8e3,path=require("path"),mongoose=require("mongoose"),dbUrl="mongodb://localhost/itcast";mongoose.connect(dbUrl);var express=require("express"),xtpl=require("xtpl"),app=express();require("./model/videoInfo");var session=require("express-session");app.use(session({secret:"itcast_resouce",resave:!1,saveUninitialized:!0})),app.use("/admin",function(e,s,r){var t=e.session||{};return t.username?void r():(s.set({"Content-Type":"text/html;charset=utf-8"}),void s.end("<script>alert('您还未登录，点击确定跳转到登录页');window.location='/account/login'</script>"))});var bodyParser=require("body-parser");app.use(bodyParser());var adminRouter=require("./routes/adminRouter"),forntRouter=require("./routes/Router"),accountRouter=require("./routes/accountRoute");app.use(express["static"](path.join(__dirname,"../statics"))),app.use(express["static"](path.join(__dirname,"../bowerlib"))),app.use(express["static"](path.join(__dirname,"../upload"))),app.set("views",path.join(__dirname,"../views")),app.set("view engine","html"),app.engine("html",xtpl.renderFile),app.use("/admin",adminRouter),app.use("/",forntRouter),app.use("/",accountRouter),app.use(function(e,s,r,t){console.error("出错了--->"+e.stack),r.status(500).end("出错了，请联系管理员")}),app.listen(PORT,function(){console.log("服务器启动,, 请访问: http://localhost:"+PORT)});